---
layout: post
title:  "《分布式系统》读书笔记 - 第二章 系统模型"
date:   2018-09-26 03:00:00 +0800
categories: DistributedSystems
tags: DistributedSystems

---

## 第二章 系统模型

### 1.物理模型

是指抽象出来的分布式系统底层硬件元素的表示

### 2.体系结构模型

一个系统的体系结构是用独立指定的组件以及这些组件之间的关系来表示的结构

#### 2.1 通信实体（什么在通信）

- 面向系统的实体：节点、进程
- 面对问题的实体：对象、组件、Web服务

#### 2.2 通信范围（他们怎么通信）

- 进程间通信：消息传递、套接字、多播
- 远程调用：请求-应答、RPC、RMI
- 间接通信：组通信、发布-订阅、消息队列、元组空间、DSM

#### 2.3 客户-服务器

如Web搜索、伸缩性比较差。

#### 2.4 对等体系结构

所有进程扮演相同的角色，作为对等方进行协作交互。   
每个对象在几个计算机中被复制，以便以后分散负载，并在某个计算机断链时仍能正常工作。


### 3.体系结构模式

#### 3.1 分层体系结构

一个复杂的系统被分成若干层，每层利用下层提供的服务。

#### 3.2 层次化体系结构

层次化体系结构和分层体系结构是互补的，分层将服务垂直组织成抽象层，而层次化是一项组织给定层功能的技术，他把这个功能放在合适的服务器上，或者作为第二选择放在物理节点上。

#### 3.3 瘦客户

瘦客户是指一个软件层，在执行一个应用程序或**访问远程**计算机服务时，由该软件层提供一个基于窗口的本地用户界面。

### 4.中间件的解决方案

中间件的任务是为分布式系统的开发提供一个高层的编程抽象，并且通过分层，对底层基础设施中的异构性提供抽象，从而提升互操作性和可移植性。

### 5.交互模型

影响进程交互的两个重要因素：

- 通信性能经常是一个限制特性
- 不可能维护一个全局时间概念

#### 5.1 同步分布式系统

他必须满足如下约束：

- 进程执行每一步的时间有一个上限和下限。
- 通过通道传递的每个消息在一个已知的时间范围内接收到。
- 每个进程有一个本地时钟。他与实际时间的偏移率在一个已知的范围内。

同步分布式系统是能够被构造出来的。所要求的是进程利用已知的资源需求完成任务，这些资源需求保证有足够的处理器周期和网络能力，还有要为进程提供漂移率在一定范围内的时钟。

#### 5.2 异步分布式系统（更适合现在的互联网）

- 进程的执行速度：每一步能花费任意长的时间
- 消息传递延迟：消息可在任意长时间后接收到
- 时钟漂移率：任意

**对异步分布式系统又想的任何解决方案对同步系统同样有效**

#### 5.3 Pepperland协定

Pepperland军队的A，B两个集团分别在邻近两座山的山顶上，山谷是入侵的敌军。A、B需要协商谁先攻击且何时攻击（达成共识），他们协商用信使（假设信道是可信的，内容不会被替换）。

此时，在异步系统里，A给B的消息，可能3分钟到，也可能3天才到。所以无解。

如果A，B知道一些有用的约束：“每个消息至少花费min分钟和至多max分钟到达”。此时率先发送“冲锋”消息的集团等待min分钟后就可以开始冲锋，另一个集团在收到消息1分钟后再冲锋。那么在率先冲锋的集团之后，不超过（max - min + 1）分钟，另一个集团保证会冲锋，所以有解。

#### 5.4 逻辑时间

时钟不能精确同步时，可用**逻辑时间**（Lamport[1978]）来代表事件发生顺序。

### 6.故障模型

#### 6.1 看对通信故障时达成协定的不可能性

现在假设Pepperland通信兵可能被敌军抓住（还能洗脑，从而让他传达错误消息）。那么此时A、B能一致决定冲锋或者投降么？很遗憾，在这样的环境中，A、B不能一致的决定做什么。

#### 6.2 随机故障

术语**随机故障**或**拜占庭故障**用于描述可能出现的最坏故障，此时可能发生任何类型的错误。进程的随机故障是指进程随机地省略要做的处理步骤或执行一些不需要的处理步骤。所以我们不能通过查询是否应答来检测，因为它可能随机的遗漏应答。

通信通道也可能有这种错误，但我们可以用校验码来检测坏消息。

#### 6.3 时序故障

适用于同步分布式系统，因为在这样的系统中，对进程执行时间、消息传递时间和时钟漂移均有限制。异步系统本来就不能满足这些要求，所以这种问题是不存在的。

#### 6.4 一对一通信的可靠性

可靠通信：

- 有效性：外发消息缓冲区中的任何消息最终能传递到接收消息缓冲区。
- 完整性：接收到的消息和发送的消息一致，没有重传。

对于完整性的威胁：

- 任何重发消息但不拒绝到达两次的消息的协议。要检测是否到达两次，可以在协议中给消息加序号。
- 心怀恶意的用户，他们可能插入伪造的消息、重放旧的消息或篡改消息。

### 7.安全模型

**通过保证进程和用于进程交互的通道的安全以及保护所封装对象免遭未授权访问，可实现分布式系统的安全。**

#### 7.1 威胁

- 对进程的威胁： 一个用于处理到达的请求的进程可以接受来自其他进程的消息，但未必能确定发送方身份。
- 对通信信道的威胁：一个敌人在网络或者网关上行进时能复制、改变或者插入消息。当信息在网上传递时，这种攻击会对信息的私密性和完整性构成威胁，对系统的完整性也会构成威胁。

#### 7.2 解除安全威胁

- 认证：PKI/CA体系
- 安全通道：安全通道作为已有通信服务层之上的服务层。
	- 每个进程确切知道其他正在执行的进程做代表的主体身份。
	- 安全通道确保在其上传送的数据的私密性和完整性（防止篡改）。
	- 每个消息包括一个物理的或者逻辑的时间戳以防消息被重放或者重排序。

#### 7.3 其他威胁

- 拒绝服务：DoS和DDoS（本博客有专门的文章）
- 移动代码：进程可能需要接收和执行来自其他地方的程序代码。容易受到特洛伊木马攻击。

