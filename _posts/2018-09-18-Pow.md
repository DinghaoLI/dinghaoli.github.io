---
layout: post
title:  "共识算法系列：PoW算法综述，优缺点总结"
date:   2018-09-18 20:00:00 +0800
categories: Blockchain
tags: Blockchain

---


本文参考：

[The Proof-of-Work Concept](https://nakamotoinstitute.org/mempool/the-proof-of-work-concept/)  
[从Paxos到区块链](http://catkang.github.io/2018/03/24/paxos-pbft-pow.html)  
[Bitcoin: A Peer-to-Peer Electronic Cash System](https://bitcoin.org/bitcoin.pdf)  
[Proof of Work as it relates to the theory of the firm](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2993312) 

PBFT虽然已经解决了拜占庭问题，但有两个明显的缺陷：

- 大量的网络交互：每个阶段的大量广播消息；
- 对大多数的判断是跟节点总结数相关的，因此集群成员需要稳定，很难变化。

这两个问题导致其不能更广泛的应用在常规的互联网环境中。这就需要一种新的对大多数的定义和判断。区块链中提出了一种即聪明又昂贵的思路：工作量证明（Proof-of-Work）。

**根据比特币的基本思路:**

- 为了能在无中心的环境中避免重复支出（double-spend）问题，就需要将所有的交易广播到整个网络，并且整个集群需要对交易历史达成一致；  

- 因此引入了区块Block，每个Block中包含多个当前网络中的交易事务；  

- 每个区块会对当前区块事务以及前一个区块计算一个哈希值，从而将Block串成一个链表。这个哈希值也证明某一时刻某个事务的存在；  

![](../../../images/article/pow.png)


<b>问题是</b>：如何让集群中的大多数对同一个Block链达成一致。在这样一个节点可以随时加入或退出的开放的网络环境中，基于节点数量的大多数判断不再适用。工作量证明（Proof-of-Work）用计算能力来确定大多数：

- 极大增加生成Block需要的计算量：要求Block在计算哈希值时，通过选择参与哈希值计算的Nonce，来获得一个前缀有指定个0的哈希值：hash(Pre-Block + Nonce + All Transaction) < X；

- 由于Block链的生成方式，篡改任何一个Block都需要对其后所有Block的哈希值重新计算；  

- 当一个Block后有足够数量个后继Block时，认为攻击者不足以获得足够颠覆整个链的计算能力时，就算对当前最长的主链达成了大多数，从而完成记账；

- 给予消耗计算能力创建Block的矿工一定奖励，从而：
  - 加快主链的生成速度，增加恶意节点难度，减少记账时间；
  - 对于拥有足够大量计算能力的节点，诚实的参与到主链的创建中比篡改Block能获得更大的收益，这就是属于博弈论的内容了。

![](../../../images/article/pow2.png)

<b>这里的大多数是指维持一定数量Block的主链领先的计算能力。</b>

### 特征/优点：
- 通信复杂度O(n)
- 节点数可拓展，可容纳节点数非常大
- 每十分钟产出一个1M block（最大容量2000多笔交易, 由此得平均3-4个交易每秒）
- 适用于unpermissioned systems（公链），可容纳故障节点和作恶节点
- Pow结合了博弈论，使用经济奖惩机制去解决恶意节点的问题。使所有自由节点利益最大化的行为（挖矿机制和选择最长链作为账本），会让攻击者花费大于收益的成本攻击。这个算法能稳定运行的一个重要原因就是：攻击者往往需要花费大于收益的成本去发动攻击，从而得不偿失。 
- Bitcoin在CAP中选择了A和P，虽然弱化了C但是，一定时间内仍可以可达一致性, 而且是目前最稳定的公链算法
- Pow 在bitcoin系统中的循环中达到了非常重要的作用：
  blockchain的安全性(Pow) -> bitcoin的价格 -> 健康的挖矿系统(Pow) -> blockchain的安全性(Pow) -> ...

### 缺点：
- 算力容易集中，没有达到完美的去中心话（矿场）
- 效率低下，耗能高但是TPS不高。
- 需要设计一套完整的经济奖惩制度

### 总结

#### 无论Paxos，PBFT还是Pow，都是要解决不同网络环境下的一致性问题，而一致性问题的重点在<b>大多数</b>，无论正常的处理流程还是故障恢复流程，都依赖两个不同的<b>大多数</b>一定有交集的特性。

- 内网安全环境下的Paxos，超过半数节点即可确定大多数；

- 考虑拜占庭容错的PBFT，由于需要面对的恶意节点不仅可能作出错误答复或不答复，还有可能阻止正常节点响应，因此需要在至少2/3个能响应的节点中达到过半数。

- 工作量证明（Pow）用维持一定数量Block的主链领先的计算能力作为大多数，从而满足任意节点可能随时加入退出的更为广泛的环境需求。


